---
export interface Props {
  titre?: string;
  href?: string;
  label?: string;         // texte du bouton
  icon?: string;          // emoji/icone (optionnel, si tu veux l’afficher)
  type?: 'exercice' | 'atelier' | 'mission' | 'bonus';
  tone?: 'indigo' | 'tomato' | 'emerald' | 'slate'; // palette
  bg?: 'soft' | 'tint' | 'solid'; // style de fond
  image?: string;         // chemin du visuel
  imageAlt?: string;
  ratio?: '16/9' | '4/3' | '1/1' | '21/9';
  align?: 'left' | 'right'; // position du visuel
  id?: string;          // ← ancre optionnelle
  tocLabel?: string;    // ← libellé pour le TOC (par défaut = titre)
}

const {
  titre = "C’est à vous !",
  href,
  label = "Accéder à l’exercice",
  icon = "✏️",
  type = 'exercice',
  tone = 'indigo',
  bg = 'soft',
  image,
  imageAlt = "",
  ratio = '16/9',
  align = 'right',
  tocLabel,
  id,
} = Astro.props;

// petite slugification au besoin
const toSlug = (s:string) =>
  s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')
   .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

const anchorId = id ?? `exo-${toSlug(titre)}`;
const tocText  = tocLabel ?? titre;
---

<aside
  id={anchorId}
  data-toc-kind="exercice"
  data-toc-text={tocText}
  class={`exercice exercice--tone-${tone} exercice--bg-${bg} ${align === 'right' ? 'is-right' : 'is-left'}`}
  data-type={type}
  aria-label={type}
>
  <div class="exercice__consigne">
    <div class="exercice__header">
      <span class="exercice__badge">{type}</span>
      <h3 class="exercice__titre">{titre}</h3>
    </div>

    <div class="exercice__content">
      <slot />
    </div>

    {href && (
      <div class="exercice__actions">
        <a href={href} class="exercice__btn" target="_blank" rel="noopener noreferrer">
          {label}
        </a>
      </div>
    )}
  </div>

  <!-- <div class="exercice__visuel" style={`--ratio: ${ratio};`}> -->
  <div class="exercice__visuel">
    {image
      ? (
        <figure class="exercice__media">
          <div class="exercice__media-inner">
            <img src={image} alt={imageAlt} loading="lazy" />
          </div>
        </figure>
      )
      : (
        // fallback : slot pour fournir un visuel custom si besoin
        <slot name="visuel" />
      )
    }
  </div>
</aside>
